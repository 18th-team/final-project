<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" th:fragment="chat">
<head>
    <link rel="stylesheet" href="/css/chat.css">
</head>
<body>
<div class="container-fluid px-0">
    <div class="chat-system">
        <!-- Messages List -->
        <section class="messages-list" aria-label="Messages List" id="messagesList">
            <header class="messages-header">
                <h1>채팅</h1>
            </header>

            <div class="messages-tabs">
                <button class="tab-button tab-group">
                    <span>모임</span>
                    <span class="unread-badge" id="groupUnreadCount">0</span>
                </button>
                <button class="tab-button tab-personal active">
                    <span>개인</span>
                    <span class="unread-badge" id="personalUnreadCount">0</span>
                </button>
            </div>

            <div class="chat-list" id="chatList">
                <!-- 동적으로 채팅 항목이 추가됨 -->
            </div>
        </section>
        <!-- Personal Chat Window -->
        <section class="chat-window personal-chat" aria-label="Personal Chat Window">
            <header class="chat-header p-3 border-bottom-f0f0f0 justify-content-around">
                <button class="back-button" aria-label="Go back">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M12.5 15L7.5 10L12.5 5" stroke="#111111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
                <div class="chat-profile">
                    <div class="avatar personal">
                        <span></span> <!-- 동적으로 이름 초기자 삽입 -->
                        <div class="status-indicator"></div>
                    </div>
                    <div class="profile-info">
                        <h2 class="chat-name"></h2> <!-- 동적으로 이름 삽입 -->
                        <p class="chat-status">Active now</p> <!-- 상태는 추후 동적 업데이트 가능 -->
                    </div>
                </div>
                <div class="chat-options">
                    <button class="options-button" aria-label="More options">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M4 12C4 12.5523 4.44772 13 5 13C5.55228 13 6 12.5523 6 12C6 11.4477 5.55228 11 5 11C4.44772 11 4 11.4477 4 12Z" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M11 12C11 12.5523 11.4477 13 12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12Z" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M18 12C18 12.5523 18.4477 13 19 13C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11C18.4477 11 18 11.4477 18 12Z" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                    <div class="options-menu">
                        <button class="block-option">차단하기</button>
                        <button class="leave-option">나가기</button>
                    </div>
                </div>
            </header>

            <div class="messages-container">
                <article class="date-notification">
                    <time datetime="2024-01-15" class="date-text">2024년 1월 15일</time>
                </article>

                <article class="system-notification">
                    <p class="approval-text">김민수님이 승인하셨습니다</p>
                </article>

                <article class="message-received">
                    <div class="avatar" aria-label="김민수의 아바타">MS</div>
                    <div class="message-content">
                        <header class="message-header">
                            <h2 class="user-name">김민수</h2>
                            <time datetime="14:30" class="timestamp">오후 2:30</time>
                        </header>
                        <p class="message-text">
                            안녕하세요, 프로젝트 관련해서 이야기 나누고 싶습니다.
                        </p>
                    </div>
                </article>

                <article class="message-sent">
                    <header class="message-header">
                        <time datetime="14:31" class="timestamp">오후 2:31</time>
                    </header>
                    <p class="message-text">
                        네, 안녕하세요! 프로젝트에 대해 이야기 나누고 싶습니다.
                    </p>
                </article>

                <article class="message-received">
                    <div class="avatar" aria-label="김민수의 아바타">MS</div>
                    <div class="message-content">
                        <header class="message-header">
                            <h2 class="user-name">김민수</h2>
                            <time datetime="14:30" class="timestamp">오후 2:30</time>
                        </header>
                        <p class="message-text">
                            안녕하세요, 프로젝트 관련해서 이야기 나누고 싶습니다.
                        </p>
                    </div>
                </article>

                <article class="date-notification">
                    <time datetime="2024-01-15" class="date-text">2024년 1월 15일</time>
                </article>

                <article class="system-notification">
                    <p class="join-text">김민수님이 채팅방에 참여하셨습니다</p>
                </article>

            </div>

            <footer class="chat-input">
                <div class="input-container">
                    <input type="text" placeholder="메시지를 입력하세요" class="message-input" aria-label="Type a message" />
                    <button class="send-button" aria-label="Send message">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M18.3331 1.66663L9.1665 10.8333M18.3331 1.66663L12.4998 18.3333L9.1665 10.8333M18.3331 1.66663L1.6665 7.49996L9.1665 10.8333" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                </div>
            </footer>
        </section>


        <!-- Chat Icons -->
        <div class="chat-icons">
            <button class="chat-button chat-open" aria-label="Open chat" id="openChat">
                <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M27.9963 15.5038C27.9963 17.2173 27.6513 18.8464 27.0265 20.3336V20.3375C26.6393 21.2613 26.5703 22.2886 26.8118 23.2622L27.4903 25.9799C27.7203 26.8922 26.8923 27.724 25.9762 27.494L23.2585 26.8155C22.2848 26.5741 21.2575 26.6431 20.3337 27.0302C18.8465 27.655 17.2174 28 15.5039 28C8.62334 28 3.00007 22.3844 3.00007 15.5038C2.99624 8.59644 8.59651 3 15.5039 3C22.3845 3 27.9963 8.62328 27.9963 15.5038Z" fill="white"/>
                </svg>
            </button>
            <button class="chat-button chat-close hidden" aria-label="Close chat" id="closeChat">
                <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M22.3079 9.57893C22.4512 9.44056 22.5655 9.27504 22.6441 9.09204C22.7227 8.90903 22.7641 8.7122 22.7658 8.51303C22.7675 8.31387 22.7296 8.11635 22.6542 7.932C22.5787 7.74766 22.4674 7.58018 22.3265 7.43934C22.1857 7.2985 22.0182 7.18712 21.8339 7.1117C21.6495 7.03628 21.452 6.99833 21.2528 7.00006C21.0537 7.00179 20.8568 7.04317 20.6738 7.12178C20.4908 7.20039 20.3253 7.31467 20.1869 7.45793L14.8829 12.7619L9.58043 7.45943C9.29772 7.18599 8.91892 7.03452 8.52562 7.03766C8.13232 7.0408 7.75599 7.19828 7.47768 7.4762C7.19937 7.75412 7.04135 8.13023 7.03765 8.52353C7.03396 8.91682 7.18489 9.29584 7.45793 9.57893L12.7619 14.8829L7.45793 20.1854C7.31467 20.3238 7.20039 20.4893 7.12178 20.6723C7.04317 20.8553 7.00179 21.0522 7.00006 21.2513C6.99833 21.4505 7.03628 21.648 7.1117 21.8324C7.18712 22.0167 7.2985 22.1842 7.43934 22.325C7.58018 22.4659 7.74766 22.5772 7.932 22.6527C8.11635 22.7281 8.31387 22.766 8.51303 22.7643C8.7122 22.7626 8.90903 22.7212 9.09204 22.6426C9.27504 22.564 9.44056 22.4497 9.57893 22.3064L14.8829 17.0039L20.1869 22.3079C20.4684 22.5892 20.8501 22.7471 21.248 22.747C21.6459 22.7468 22.0274 22.5886 22.3087 22.3072C22.5899 22.0257 22.7479 21.6441 22.7477 21.2462C22.7476 20.8482 22.5894 20.4667 22.3079 20.1854L17.0039 14.8829L22.3079 9.57893Z" fill="black"/>
                </svg>
            </button>
        </div>
    </div>
</div>

<!-- WebSocket 클라이언트 라이브러리 (프래그먼트 외부에서 로드 필요) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script th:inline="javascript">
    const currentUser = /*[[${currentUser}]]*/ null;
    console.log("Current User in chat.html: " + currentUser);
</script>
<script src="/js/chat.js"></script>
</body>
</html>